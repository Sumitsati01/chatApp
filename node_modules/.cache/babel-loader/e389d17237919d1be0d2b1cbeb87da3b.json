{"ast":null,"code":"import _defineProperty from\"/home/user/React/git/chat/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _regeneratorRuntime from\"/home/user/React/git/chat/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/user/React/git/chat/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/user/React/git/chat/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useContext,useState}from'react';import Upload from'../img/upload-image-2.webp';import Attach from'../img/attach.png';import{arrayUnion,doc,serverTimestamp,Timestamp,updateDoc}from'firebase/firestore';import{db,storage}from'../Pages/Firebase';import{v4 as uuid}from'uuid';import{AuthContext}from'../context/authContext';import{ChatContext}from'../context/chatContext';import{getDownloadURL,ref,uploadBytesResumable}from'firebase/storage';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function Input(){var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),text=_useState2[0],setText=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),img=_useState4[0],setImg=_useState4[1];var _useContext=useContext(AuthContext),currentUser=_useContext.currentUser;var _useContext2=useContext(ChatContext),data=_useContext2.data;var handleSend=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var _updateDoc,_updateDoc2;var storageRef,uploadTask;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!img){_context2.next=8;break;}storageRef=ref(storage,uuid());_context2.next=4;return uploadBytesResumable(storageRef,img);case 4:uploadTask=_context2.sent;// console.log(uploadTask)\nuploadTask.on('state_changed',function(error){},function(){getDownloadURL(uploadTask.ref).then(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(downloadURL){return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return updateDoc(doc(db,\"chats\",data.chatID),{messages:arrayUnion({id:uuid(),text:text,senderId:currentUser.uid,date:Timestamp.now(),img:downloadURL})});case 2:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref2.apply(this,arguments);};}());});_context2.next=10;break;case 8:_context2.next=10;return updateDoc(doc(db,'chats',data.chatID),{messages:arrayUnion({id:uuid(),text:text,senderID:currentUser.uid,Date:Timestamp.now()})});case 10:_context2.next=12;return updateDoc(doc(db,'userChats',currentUser.uid),(_updateDoc={},_defineProperty(_updateDoc,data.chatID+\".lastMessage\",{text:text}),_defineProperty(_updateDoc,data.chatID+\".date\",serverTimestamp()),_updateDoc));case 12:_context2.next=14;return updateDoc(doc(db,'userChats',data.user.uid),(_updateDoc2={},_defineProperty(_updateDoc2,data.chatID+\".lastMessage\",{text:text}),_defineProperty(_updateDoc2,data.chatID+\".date\",serverTimestamp()),_updateDoc2));case 14:setText(\"\");setImg(null);case 16:case\"end\":return _context2.stop();}}},_callee2);}));return function handleSend(){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{className:\"input\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Type Something Here....\",onChange:function onChange(e){return setText(e.target.value);},value:text}),/*#__PURE__*/_jsxs(\"div\",{className:\"send\",children:[/*#__PURE__*/_jsx(\"img\",{src:Attach,alt:\"attach\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",style:{display:'none'},id:\"file\",onChange:function onChange(e){return setImg(e.target.files[0]);}}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"file\",children:/*#__PURE__*/_jsx(\"img\",{src:Upload,alt:\"\"})}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSend,children:\"Send\"})]})]});}export default Input;","map":null,"metadata":{},"sourceType":"module"}