{"ast":null,"code":"import _defineProperty from\"/home/user/React/git/chat/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _regeneratorRuntime from\"/home/user/React/git/chat/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/user/React/git/chat/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/user/React/git/chat/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState}from'react';import{useContext}from'react';import{AuthContext}from'../context/authContext';import{collection,query,where,getDoc,setDoc,doc,updateDoc,serverTimestamp,getDocs}from\"firebase/firestore\";import{db}from'../Pages/Firebase';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function Search(){var _useContext=useContext(AuthContext),currentUser=_useContext.currentUser;var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),userName=_useState2[0],setUserName=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),user=_useState4[0],setUser=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),err=_useState6[0],setErr=_useState6[1];//console.log(userName);\nvar handleSearch=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var q,querySnapshot;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:q=query(collection(db,\"users\"),where(\"displayName\",\"==\",userName));console.log(q);_context.prev=2;_context.next=5;return getDocs(q);case 5:querySnapshot=_context.sent;querySnapshot.forEach(function(doc){setUser(doc.data());});_context.next=12;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](2);setErr(true);case 12:case\"end\":return _context.stop();}}},_callee,null,[[2,9]]);}));return function handleSearch(){return _ref.apply(this,arguments);};}();var handleKey=function handleKey(e){e.code===\"Enter\"&&handleSearch();};var handleSelect=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var combinedId,_updateDoc,_updateDoc2,res;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:combinedId=currentUser.uid>user.uid?currentUser.uid+user.uid:user.uid+currentUser.uid;_context2.prev=1;_context2.next=4;return getDoc(doc(db,\"chats\",combinedId));case 4:res=_context2.sent;if(res.exists()){_context2.next=8;break;}_context2.next=8;return setDoc(doc(db,\"chats\",combinedId),{messages:[]});case 8:_context2.next=10;return updateDoc(doc(db,'userChats',currentUser.uid),(_updateDoc={},_defineProperty(_updateDoc,combinedId+'.userInfo',{uid:user.uid,displayName:user.displayName,photoURL:user.photoURL}),_defineProperty(_updateDoc,combinedId+'.date',serverTimestamp()),_updateDoc));case 10:_context2.next=12;return updateDoc(doc(db,'userChats',user.uid),(_updateDoc2={},_defineProperty(_updateDoc2,combinedId+'.userInfo',{uid:currentUser.uid,displayName:currentUser.displayName,photoURL:currentUser.photoURL}),_defineProperty(_updateDoc2,combinedId+'.date',serverTimestamp()),_updateDoc2));case 12:_context2.next=16;break;case 14:_context2.prev=14;_context2.t0=_context2[\"catch\"](1);case 16:setUser(null);setUserName(\"\");case 18:case\"end\":return _context2.stop();}}},_callee2,null,[[1,14]]);}));return function handleSelect(){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{className:\"search\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"searchForm\",children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Find User\",onKeyDown:handleKey,onChange:function onChange(e){return setUserName(e.target.value);},value:userName})}),err&&/*#__PURE__*/_jsx(\"span\",{children:\"User Not Found\"}),user&&/*#__PURE__*/_jsxs(\"div\",{className:\"userChat\",onClick:handleSelect,children:[/*#__PURE__*/_jsx(\"img\",{src:user.photoURL,alt:\"\"}),/*#__PURE__*/_jsx(\"div\",{className:\"userChatInfo\",children:/*#__PURE__*/_jsx(\"span\",{children:user.displayName})})]})]});}export default Search;","map":null,"metadata":{},"sourceType":"module"}